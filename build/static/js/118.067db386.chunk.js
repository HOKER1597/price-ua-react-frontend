"use strict";(self.webpackChunkprice_ua=self.webpackChunkprice_ua||[]).push([[118],{5222:()=>{},8118:(e,t,s)=>{s.r(t),s.d(t,{default:()=>g});var o=s(2555),a=s(5043),r=s(9722),i=s(9896),n=s(9419),c=s(2023),l=s(6036),d=s(3318),u=s(9688),h=(s(5222),s(3536)),p=s.n(h),m=s(579);function y(e){let{center:t,zoom:s}=e;const o=(0,i.ko)();return(0,a.useEffect)((()=>{o.setView(t,s)}),[t,s,o]),null}const g=function(){const[e,t]=(0,a.useState)([]),[s,i]=(0,a.useState)([]),[h,g]=(0,a.useState)({store_id:"",city_id:"",street:"",house:"",postal_code:"",hours_mon_fri:"",hours_sat:"",hours_sun:"",latitude:null,longitude:null}),[_,f]=(0,a.useState)([]),[v,S]=(0,a.useState)([]),[x,j]=(0,a.useState)(null),[C,N]=(0,a.useState)(null),[b,A]=(0,a.useState)(!1),[w,H]=(0,a.useState)([50.4501,30.5234]),[K,F]=(0,a.useState)(13);(0,a.useEffect)((()=>{(async()=>{try{const e=await r.A.get("".concat(u.H,"/stores"));t(e.data.sort(((e,t)=>e.name.localeCompare(t.name))))}catch(e){console.error("\u041f\u043e\u043c\u0438\u043b\u043a\u0430 \u0437\u0430\u0432\u0430\u043d\u0442\u0430\u0436\u0435\u043d\u043d\u044f \u043c\u0430\u0433\u0430\u0437\u0438\u043d\u0456\u0432:",e),j("\u041d\u0435 \u0432\u0434\u0430\u043b\u043e\u0441\u044f \u0437\u0430\u0432\u0430\u043d\u0442\u0430\u0436\u0438\u0442\u0438 \u043c\u0430\u0433\u0430\u0437\u0438\u043d\u0438.")}})(),(async()=>{try{const e=await r.A.get("".concat(u.H,"/cities"));i(e.data.sort(((e,t)=>e.name_ua.localeCompare(t.name_ua))))}catch(e){console.error("\u041f\u043e\u043c\u0438\u043b\u043a\u0430 \u0437\u0430\u0432\u0430\u043d\u0442\u0430\u0436\u0435\u043d\u043d\u044f \u043c\u0456\u0441\u0442:",e),j("\u041d\u0435 \u0432\u0434\u0430\u043b\u043e\u0441\u044f \u0437\u0430\u0432\u0430\u043d\u0442\u0430\u0436\u0438\u0442\u0438 \u043c\u0456\u0441\u0442\u0430.")}})()}),[]),(0,a.useEffect)((()=>{(async()=>{if(h.store_id&&h.city_id){console.log("[Last Hours] Fetching hours for:",{store_id:h.store_id,city_id:h.city_id});try{const e=await r.A.get("".concat(u.H,"/admin/store-location/last-hours"),{params:{store_id:h.store_id,city_id:h.city_id},headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});console.log("[Last Hours] Response:",e.data),g((t=>(0,o.A)((0,o.A)({},t),{},{hours_mon_fri:e.data.hours_mon_fri||"",hours_sat:e.data.hours_sat||"",hours_sun:e.data.hours_sun||""})))}catch(s){var e,t;console.error("[Last Hours] Error fetching hours:",{message:s.message,status:null===(e=s.response)||void 0===e?void 0:e.status,data:null===(t=s.response)||void 0===t?void 0:t.data}),g((e=>(0,o.A)((0,o.A)({},e),{},{hours_mon_fri:"",hours_sat:"",hours_sun:""})))}}})()}),[h.store_id,h.city_id]),(0,a.useEffect)((()=>{if(h.city_id){const e=s.find((e=>e.id.toString()===h.city_id));e&&e.latitude&&e.longitude&&(H([parseFloat(e.latitude),parseFloat(e.longitude)]),F(12))}}),[h.city_id,s]);const I=p().debounce((async(e,t)=>{console.log("[Street Search] Debounced request for query: ".concat(e,", City: ").concat(t.name_ua));try{let s=await r.A.get("https://api.geoapify.com/v1/geocode/autocomplete",{params:{text:"\u0432\u0443\u043b\u0438\u0446\u044f ".concat(e),filter:"rect:30.3,50.3,30.7,50.6",bias:"proximity:".concat(t.longitude,",").concat(t.latitude),type:"street",lang:"uk",apiKey:"324aff0bdde84e2bac50eced8f04c147",limit:20}});console.log("[Street Search] Geoapify API Response (Raw):",s.data),console.log("[Street Search] Geoapify Features:",s.data.features);let o=s.data.features.filter((s=>{const o=s.properties.street,a=(s.properties.street?s.properties.street.replace(/^\u0432\u0443\u043b\u0438\u0446\u044f\s+/i,""):"").toLowerCase().includes(e.toLowerCase()),r=s.properties.city===t.name_ua;return console.log("[Street Search] Geoapify Item: ".concat(s.properties.street||"No street",", City: ").concat(s.properties.city||"No city",", MatchesInput: ").concat(a,", IsCityKyiv: ").concat(r)),o&&a})).map((e=>({name:e.properties.street,lat:e.geometry.coordinates[1],lon:e.geometry.coordinates[0],isCityKyiv:e.properties.city===t.name_ua})));o=p().uniqBy(o,"name").sort(((e,t)=>e.isCityKyiv&&!t.isCityKyiv?-1:!e.isCityKyiv&&t.isCityKyiv?1:0)),console.log("[Street Search] Unique Streets:",o),0===o.length&&(console.log("[Street Search] No results with Geoapify, falling back to Nominatim"),s=await r.A.get("https://nominatim.openstreetmap.org/search",{params:{street:"\u0432\u0443\u043b\u0438\u0446\u044f ".concat(e),city:t.name_ua,country:"Ukraine",format:"json",addressdetails:1,limit:20}}),console.log("[Street Search] Nominatim API Response (Raw):",s.data),o=s.data.filter((s=>{const o=s.address.road,a=(s.address.road?s.address.road.replace(/^\u0432\u0443\u043b\u0438\u0446\u044f\s+/i,""):"").toLowerCase().includes(e.toLowerCase()),r=s.address.city===t.name_ua;return console.log("[Street Search] Nominatim Item: ".concat(s.address.road||"No road",", City: ").concat(s.address.city||"No city",", MatchesInput: ").concat(a,", IsCityKyiv: ").concat(r)),o&&a})).map((e=>({name:e.address.road,lat:e.lat,lon:e.lon,isCityKyiv:e.address.city===t.name_ua}))),o=p().uniqBy(o,"name").sort(((e,t)=>e.isCityKyiv&&!t.isCityKyiv?-1:!e.isCityKyiv&&t.isCityKyiv?1:0)),console.log("[Street Search] Unique Nominatim Streets:",o)),console.log("[Street Search] Final Filtered Streets:",o);const a=s.data.features?s.data.features.some((e=>e.properties.street&&e.properties.street.includes("\u0421\u0442\u0435\u0446\u0435\u043d\u043a\u0430"))):s.data.some((e=>e.address.road&&e.address.road.includes("\u0421\u0442\u0435\u0446\u0435\u043d\u043a\u0430")));console.log('[Street Search] "\u0421\u0442\u0435\u0446\u0435\u043d\u043a\u0430" in response: '.concat(a)),f(o),0===o.length&&console.warn("[Street Search] No streets found for input: ".concat(e,", City: ").concat(t.name_ua))}catch(l){var s,o,a,i,n,c;console.error("[Street Search] Error fetching streets:",{message:l.message,status:null===(s=l.response)||void 0===s?void 0:s.status,data:null===(o=l.response)||void 0===o?void 0:o.data,url:null===(a=l.config)||void 0===a?void 0:a.url,params:null===(i=l.config)||void 0===i?void 0:i.params}),400===(null===(n=l.response)||void 0===n?void 0:n.status)?j("\u041d\u0435\u043a\u043e\u0440\u0435\u043a\u0442\u043d\u0438\u0439 \u0437\u0430\u043f\u0438\u0442 \u0434\u043e Geoapify. \u041f\u0435\u0440\u0435\u0432\u0456\u0440\u0442\u0435 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0438."):401===(null===(c=l.response)||void 0===c?void 0:c.status)&&j("\u041f\u043e\u043c\u0438\u043b\u043a\u0430 \u0430\u0432\u0442\u0435\u043d\u0442\u0438\u0444\u0456\u043a\u0430\u0446\u0456\u0457 API. \u041f\u0435\u0440\u0435\u0432\u0456\u0440\u0442\u0435 \u043a\u043b\u044e\u0447\u0456 Geoapify.")}}),300),q=p().debounce((async(e,t,s)=>{console.log("[House Search] Debounced request for house: ".concat(e,", Street: ").concat(t,", City: ").concat(s.name_ua));let o=[];try{const a=await r.A.get("https://nominatim.openstreetmap.org/search",{params:{street:"".concat(e," ").concat(t),city:s.name_ua,country:"Ukraine",format:"json",addressdetails:1,limit:20}});console.log("[House Search] Nominatim API Response (Raw):",a.data),o=a.data.filter((e=>{const o=e.address.house_number,a=e.address.road===t,r=e.address.city===s.name_ua;return console.log("[House Search] Nominatim Item: ".concat(e.address.house_number||"No house_number",", Street: ").concat(e.address.road||"No road",", City: ").concat(e.address.city||"No city",", Postcode: ").concat(e.address.postcode||"No postcode",", MatchesStreet: ").concat(a,", IsCityKyiv: ").concat(r)),o&&a})).map((e=>({name:e.address.house_number,lat:e.lat,lon:e.lon,postcode:e.address.postcode||"",isCityKyiv:e.address.city===s.name_ua}))),o=p().uniqBy(o,"name").sort(((e,t)=>e.isCityKyiv&&!t.isCityKyiv?-1:!e.isCityKyiv&&t.isCityKyiv?1:0)),console.log("[House Search] Unique Nominatim Houses:",o),console.log("[House Search] Final Filtered Houses:",o),S(o),0===o.length&&console.warn("[House Search] No houses found for input: ".concat(e,", Street: ").concat(t,", City: ").concat(s.name_ua))}catch(n){var a,i;console.error("[House Search] Nominatim Error:",{message:n.message,status:null===(a=n.response)||void 0===a?void 0:a.status,data:null===(i=n.response)||void 0===i?void 0:i.data}),j("\u041d\u0435 \u0432\u0434\u0430\u043b\u043e\u0441\u044f \u0437\u043d\u0430\u0439\u0442\u0438 \u043d\u043e\u043c\u0435\u0440\u0438 \u0431\u0443\u0434\u0438\u043d\u043a\u0456\u0432 \u0447\u0435\u0440\u0435\u0437 Nominatim. \u0421\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0456\u043d\u0448\u0438\u0439 \u043d\u043e\u043c\u0435\u0440 \u0430\u0431\u043e \u043f\u0435\u0440\u0435\u0432\u0456\u0440\u0442\u0435 \u043f\u0456\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u043d\u044f.")}}),300),k=async(e,t)=>{const{value:a}=e.target;if(console.log("[handleInputChange] Field: ".concat(t,", Value: ").concat(a)),g((0,o.A)((0,o.A)({},h),{},{[t]:a})),"street"===t&&a.length>=2&&h.city_id){const e=s.find((e=>e.id.toString()===h.city_id));e?(console.log("[Street Search] City found: ".concat(e.name_ua,", ID: ").concat(e.id)),I(a,e)):console.log("[Street Search] No city found for city_id:",h.city_id)}else"street"===t&&(console.log("[Street Search] Clearing suggestions: Input too short or no city selected"),f([]));if("house"===t&&a&&h.street&&h.city_id){const e=s.find((e=>e.id.toString()===h.city_id));e?q(a,h.street,e):(console.log("[House Search] No city found for city_id:",h.city_id),S([]))}else"house"===t&&(console.log("[House Search] Clearing suggestions: No house input or missing street/city"),S([]))};return(0,m.jsxs)("div",{className:"admin-product-edit animate-page",children:[(0,m.jsx)("h2",{className:"centered-heading",children:"\u0414\u043e\u0434\u0430\u0442\u0438 \u043b\u043e\u043a\u0430\u0446\u0456\u044e \u043c\u0430\u0433\u0430\u0437\u0438\u043d\u0443"}),(0,m.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),A(!0),j(null),N(null),!h.store_id||!h.city_id||!h.street||!h.house||!h.postal_code)return j("\u0417\u0430\u043f\u043e\u0432\u043d\u0456\u0442\u044c \u0443\u0441\u0456 \u043e\u0431\u043e\u0432\u2019\u044f\u0437\u043a\u043e\u0432\u0456 \u043f\u043e\u043b\u044f: \u043c\u0430\u0433\u0430\u0437\u0438\u043d, \u043c\u0456\u0441\u0442\u043e, \u0432\u0443\u043b\u0438\u0446\u044f, \u043d\u043e\u043c\u0435\u0440 \u0431\u0443\u0434\u0438\u043d\u043a\u0443, \u043f\u043e\u0448\u0442\u043e\u0432\u0438\u0439 \u0456\u043d\u0434\u0435\u043a\u0441"),void A(!1);const t=localStorage.getItem("token"),o=s.find((e=>e.id.toString()===h.city_id)),a="".concat(o.name_ua,", ").concat(h.street,", ").concat(h.house,", ").concat(h.postal_code);try{await r.A.post("".concat(u.H,"/admin/store-location"),{store_id:h.store_id,city_id:h.city_id,address:a,latitude:h.latitude,longitude:h.longitude,hours_mon_fri:h.hours_mon_fri,hours_sat:h.hours_sat,hours_sun:h.hours_sun},{headers:{Authorization:"Bearer ".concat(t)}}),N("\u041b\u043e\u043a\u0430\u0446\u0456\u044e \u043c\u0430\u0433\u0430\u0437\u0438\u043d\u0443 \u0443\u0441\u043f\u0456\u0448\u043d\u043e \u0434\u043e\u0434\u0430\u043d\u043e!"),g({store_id:"",city_id:"",street:"",house:"",postal_code:"",hours_mon_fri:"",hours_sat:"",hours_sun:"",latitude:null,longitude:null}),H([50.4501,30.5234]),F(13)}catch(c){var i,n;console.error("\u041f\u043e\u043c\u0438\u043b\u043a\u0430 \u0434\u043e\u0434\u0430\u0432\u0430\u043d\u043d\u044f \u043b\u043e\u043a\u0430\u0446\u0456\u0457:",c),j((null===(i=c.response)||void 0===i||null===(n=i.data)||void 0===n?void 0:n.error)||"\u041d\u0435 \u0432\u0434\u0430\u043b\u043e\u0441\u044f \u0434\u043e\u0434\u0430\u0442\u0438 \u043b\u043e\u043a\u0430\u0446\u0456\u044e. \u041f\u0435\u0440\u0435\u0432\u0456\u0440\u0442\u0435 \u0434\u0430\u043d\u0456 \u0430\u0431\u043e \u043f\u0456\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u043d\u044f \u0434\u043e \u0441\u0435\u0440\u0432\u0435\u0440\u0430.")}finally{A(!1)}},children:[(0,m.jsxs)("div",{className:"form-group animate-field",children:[(0,m.jsx)("label",{children:"\u041c\u0430\u0433\u0430\u0437\u0438\u043d"}),(0,m.jsxs)("select",{value:h.store_id,onChange:e=>k(e,"store_id"),required:!0,disabled:0===e.length,children:[(0,m.jsx)("option",{value:"",children:"\u0412\u0438\u0431\u0435\u0440\u0456\u0442\u044c \u043c\u0430\u0433\u0430\u0437\u0438\u043d"}),e.map((e=>(0,m.jsx)("option",{value:e.id,children:e.name},e.id)))]}),0===e.length&&(0,m.jsx)("p",{children:"\u0417\u0430\u0432\u0430\u043d\u0442\u0430\u0436\u0435\u043d\u043d\u044f \u043c\u0430\u0433\u0430\u0437\u0438\u043d\u0456\u0432..."})]}),(0,m.jsxs)("div",{className:"form-group animate-field",children:[(0,m.jsx)("label",{children:"\u041c\u0456\u0441\u0442\u043e"}),(0,m.jsxs)("select",{value:h.city_id,onChange:e=>k(e,"city_id"),required:!0,disabled:0===s.length,children:[(0,m.jsx)("option",{value:"",children:"\u0412\u0438\u0431\u0435\u0440\u0456\u0442\u044c \u043c\u0456\u0441\u0442\u043e"}),s.map((e=>(0,m.jsx)("option",{value:e.id,children:e.name_ua},e.id)))]}),0===s.length&&(0,m.jsx)("p",{children:"\u0417\u0430\u0432\u0430\u043d\u0442\u0430\u0436\u0435\u043d\u043d\u044f \u043c\u0456\u0441\u0442..."})]}),(0,m.jsxs)("div",{className:"form-group address-form animate-field",children:[(0,m.jsx)("label",{children:"\u0410\u0434\u0440\u0435\u0441\u0430"}),(0,m.jsxs)("div",{className:"address-group",children:[(0,m.jsxs)("div",{className:"input-container",children:[(0,m.jsx)("input",{type:"text",value:h.street,onChange:e=>k(e,"street"),placeholder:"\u0412\u0443\u043b\u0438\u0446\u044f",required:!0}),_.length>0&&(0,m.jsx)("div",{className:"suggestions",children:_.map(((e,t)=>(0,m.jsx)("div",{className:"suggestion-item",onClick:()=>{return t=e,console.log("[Street Select] Selected street:",t),g((0,o.A)((0,o.A)({},h),{},{street:t.name,latitude:parseFloat(t.lat),longitude:parseFloat(t.lon),house:"",postal_code:""})),H([parseFloat(t.lat),parseFloat(t.lon)]),F(15),f([]),void S([]);var t},children:e.name},t)))})]}),(0,m.jsxs)("div",{className:"input-container",children:[(0,m.jsx)("input",{type:"text",value:h.house,onChange:e=>k(e,"house"),placeholder:"\u041d\u043e\u043c\u0435\u0440 \u0431\u0443\u0434\u0438\u043d\u043a\u0443",required:!0}),v.length>0&&(0,m.jsx)("div",{className:"suggestions",children:v.map(((e,t)=>(0,m.jsx)("div",{className:"suggestion-item",onClick:()=>{return t=e,console.log("[House Select] Selected house:",(0,o.A)((0,o.A)({},t),{},{postcode:t.postcode||"No postcode"})),g((0,o.A)((0,o.A)({},h),{},{house:t.name,latitude:parseFloat(t.lat),longitude:parseFloat(t.lon),postal_code:t.postcode||h.postal_code})),H([parseFloat(t.lat),parseFloat(t.lon)]),F(18),void S([]);var t},children:e.name},t)))})]}),(0,m.jsx)("input",{type:"text",value:h.postal_code,onChange:e=>k(e,"postal_code"),placeholder:"\u041f\u043e\u0448\u0442\u043e\u0432\u0438\u0439 \u0456\u043d\u0434\u0435\u043a\u0441",required:!0})]})]}),(0,m.jsxs)("div",{className:"form-group animate-field",children:[(0,m.jsx)("label",{children:"\u041c\u0430\u043f\u0430"}),(0,m.jsxs)(n.W,{center:w,zoom:K,style:{height:"400px",width:"100%"},children:[(0,m.jsx)(y,{center:w,zoom:K}),(0,m.jsx)(c.e,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'\xa9 <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}),h.latitude&&h.longitude&&(0,m.jsx)(l.p,{position:[h.latitude,h.longitude],children:(0,m.jsxs)(d.z,{children:[h.street,", ",h.house]})})]})]}),(0,m.jsxs)("div",{className:"form-group animate-field",children:[(0,m.jsx)("label",{children:"\u0427\u0430\u0441 \u0440\u043e\u0431\u043e\u0442\u0438 (\u041f\u041d-\u041f\u0422)"}),(0,m.jsx)("input",{type:"text",value:h.hours_mon_fri,onChange:e=>k(e,"hours_mon_fri"),placeholder:"\u041d\u0430\u043f\u0440. 09:00-18:00"})]}),(0,m.jsxs)("div",{className:"form-group animate-field",children:[(0,m.jsx)("label",{children:"\u0427\u0430\u0441 \u0440\u043e\u0431\u043e\u0442\u0438 (\u0421\u0411)"}),(0,m.jsx)("input",{type:"text",value:h.hours_sat,onChange:e=>k(e,"hours_sat"),placeholder:"\u041d\u0430\u043f\u0440. 10:00-16:00"})]}),(0,m.jsxs)("div",{className:"form-group animate-field",children:[(0,m.jsx)("label",{children:"\u0427\u0430\u0441 \u0440\u043e\u0431\u043e\u0442\u0438 (\u041d\u0414)"}),(0,m.jsx)("input",{type:"text",value:h.hours_sun,onChange:e=>k(e,"hours_sun"),placeholder:"\u041d\u0430\u043f\u0440. \u0432\u0438\u0445\u0456\u0434\u043d\u0438\u0439"})]}),x&&(0,m.jsx)("div",{className:"error-message centered-message",children:x}),C&&(0,m.jsx)("div",{className:"success-message centered-message",children:C}),(0,m.jsx)("button",{type:"submit",className:"save-button animate-field",disabled:b,children:b?"\u0417\u0431\u0435\u0440\u0435\u0436\u0435\u043d\u043d\u044f...":"\u0417\u0431\u0435\u0440\u0435\u0433\u0442\u0438 \u043b\u043e\u043a\u0430\u0446\u0456\u044e"})]})]})}}}]);
//# sourceMappingURL=118.067db386.chunk.js.map