"use strict";(self.webpackChunkprice_ua=self.webpackChunkprice_ua||[]).push([[287],{2287:(e,t,a)=>{a.r(t),a.d(t,{default:()=>c});var s=a(2555),n=a(5043),i=a(9002),r=a(9722),l=a(9688),o=(a(5222),a(579));const c=function(){const[e,t]=(0,n.useState)([]),[a,c]=(0,n.useState)([]),[d,u]=(0,n.useState)([]),[p,m]=(0,n.useState)([]),[g,h]=(0,n.useState)(""),[f,x]=(0,n.useState)({category_id:"",brand_id:"",name:"",volume:"",images:[{type:"new",file:null}],code:"",features:[{key:"",value:""}],description:"",description_full:"",composition:"",usage:"",store_prices:[{store_id:"",price:"",link:""}]}),[v,y]=(0,n.useState)([]),[j,b]=(0,n.useState)(null),[_,k]=(0,n.useState)(null),[N,C]=(0,n.useState)(!1),A=(0,i.zy)();(0,n.useEffect)((()=>{const e=new URLSearchParams(A.search).get("productId");e&&h(e)}),[A]),(0,n.useEffect)((()=>{(async()=>{try{const e=await r.A.get("".concat(l.H,"/products?limit=1000"));t(e.data.products.sort(((e,t)=>e.name.localeCompare(t.name))))}catch(e){console.error("\u041f\u043e\u043c\u0438\u043b\u043a\u0430 \u0437\u0430\u0432\u0430\u043d\u0442\u0430\u0436\u0435\u043d\u043d\u044f \u0442\u043e\u0432\u0430\u0440\u0456\u0432:",e),b("\u041d\u0435 \u0432\u0434\u0430\u043b\u043e\u0441\u044f \u0437\u0430\u0432\u0430\u043d\u0442\u0430\u0436\u0438\u0442\u0438 \u0442\u043e\u0432\u0430\u0440\u0438.")}})(),(async()=>{try{const e=await r.A.get("".concat(l.H,"/categories/public"));c(e.data.sort(((e,t)=>e.name_ua.localeCompare(t.name_ua))))}catch(e){console.error("\u041f\u043e\u043c\u0438\u043b\u043a\u0430 \u0437\u0430\u0432\u0430\u043d\u0442\u0430\u0436\u0435\u043d\u043d\u044f \u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0456\u0439:",e),b("\u041d\u0435 \u0432\u0434\u0430\u043b\u043e\u0441\u044f \u0437\u0430\u0432\u0430\u043d\u0442\u0430\u0436\u0438\u0442\u0438 \u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0456\u0457.")}})(),(async()=>{try{const e=await r.A.get("".concat(l.H,"/brands"));u(e.data.sort(((e,t)=>e.name.localeCompare(t.name))))}catch(e){console.error("\u041f\u043e\u043c\u0438\u043b\u043a\u0430 \u0437\u0430\u0432\u0430\u043d\u0442\u0430\u0436\u0435\u043d\u043d\u044f \u0431\u0440\u0435\u043d\u0434\u0456\u0432:",e),b("\u041d\u0435 \u0432\u0434\u0430\u043b\u043e\u0441\u044f \u0437\u0430\u0432\u0430\u043d\u0442\u0430\u0436\u0438\u0442\u0438 \u0431\u0440\u0435\u043d\u0434\u0438.")}})(),(async()=>{try{const e=await r.A.get("".concat(l.H,"/stores"));m(e.data.sort(((e,t)=>e.name.localeCompare(t.name))))}catch(e){console.error("\u041f\u043e\u043c\u0438\u043b\u043a\u0430 \u0437\u0430\u0432\u0430\u043d\u0442\u0430\u0436\u0435\u043d\u043d\u044f \u043c\u0430\u0433\u0430\u0437\u0438\u043d\u0456\u0432:",e),b("\u041d\u0435 \u0432\u0434\u0430\u043b\u043e\u0441\u044f \u0437\u0430\u0432\u0430\u043d\u0442\u0430\u0436\u0438\u0442\u0438 \u043c\u0430\u0433\u0430\u0437\u0438\u043d\u0438.")}})()}),[]),(0,n.useEffect)((()=>{if(g){(async()=>{try{const e=(await r.A.get("".concat(l.H,"/products/").concat(g))).data,t=Object.entries(e.features||{}).map((e=>{let[t,a]=e;return{key:"hairType"===t?"type":t,value:a||""}})).filter((e=>e.key&&e.value)),a=e.images.filter((e=>e&&!e.includes("placeholder.webp"))).map((e=>({type:"existing",url:e})));x({category_id:e.category_id?e.category_id.toString():"",brand_id:e.brand_id?e.brand_id.toString():"",name:e.name||"",volume:e.volume||"",images:a.length>0?a:[{type:"new",file:null}],code:e.code||"",features:t.length>0?t:[{key:"",value:""}],description:e.description||"",description_full:e.description_full||"",composition:e.composition||"",usage:e.usage||"",store_prices:e.store_prices.length>0?e.store_prices.map((e=>({store_id:e.store_id.toString(),price:e.price.toString(),link:e.link||""}))):[{store_id:"",price:"",link:""}]}),y(e.images.filter((e=>e&&!e.includes("placeholder.webp"))))}catch(e){console.error("\u041f\u043e\u043c\u0438\u043b\u043a\u0430 \u0437\u0430\u0432\u0430\u043d\u0442\u0430\u0436\u0435\u043d\u043d\u044f \u0434\u0435\u0442\u0430\u043b\u0435\u0439 \u0442\u043e\u0432\u0430\u0440\u0443:",e),b("\u041d\u0435 \u0432\u0434\u0430\u043b\u043e\u0441\u044f \u0437\u0430\u0432\u0430\u043d\u0442\u0430\u0436\u0438\u0442\u0438 \u0434\u0430\u043d\u0456 \u0442\u043e\u0432\u0430\u0440\u0443.")}})()}else x({category_id:"",brand_id:"",name:"",volume:"",images:[{type:"new",file:null}],code:"",features:[{key:"",value:""}],description:"",description_full:"",composition:"",usage:"",store_prices:[{store_id:"",price:"",link:""}]}),y([])}),[g]);const w=(e,t,a,n)=>{const{name:i,value:r}=e.target;if("image"===n){const a=[...f.images],n=[...v];e.target.files[0]?(a[t]={type:"new",file:e.target.files[0]},n[t]=URL.createObjectURL(e.target.files[0])):(a[t]={type:"new",file:null},n[t]=null),x((0,s.A)((0,s.A)({},f),{},{images:a})),y(n)}else if("feature"===n){const e=[...f.features];e[t][a]=r,x((0,s.A)((0,s.A)({},f),{},{features:e}))}else if("store_price"===n){const e=[...f.store_prices];e[t][a]=r,x((0,s.A)((0,s.A)({},f),{},{store_prices:e}))}else x((0,s.A)((0,s.A)({},f),{},{[i]:r}))},S=()=>{f.images.length<10&&(x((0,s.A)((0,s.A)({},f),{},{images:[...f.images,{type:"new",file:null}]})),y([...v,null]))},F=e=>{const t=f.images.filter(((t,a)=>a!==e)),a=v.filter(((t,a)=>a!==e));x((0,s.A)((0,s.A)({},f),{},{images:t.length>0?t:[{type:"new",file:null}]})),y(a.length>0?a:[])},H=()=>{f.features.length<10&&x((0,s.A)((0,s.A)({},f),{},{features:[...f.features,{key:"",value:""}]}))},O=e=>{const t=f.features.filter(((t,a)=>a!==e));x((0,s.A)((0,s.A)({},f),{},{features:t.length>0?t:[{key:"",value:""}]}))},E=()=>{f.store_prices.length<10&&x((0,s.A)((0,s.A)({},f),{},{store_prices:[...f.store_prices,{store_id:"",price:"",link:""}]}))},q=e=>{const t=f.store_prices.filter(((t,a)=>a!==e));x((0,s.A)((0,s.A)({},f),{},{store_prices:t.length>0?t:[{store_id:"",price:"",link:""}]}))},D=[{key:"brand",label:"\u0411\u0440\u0435\u043d\u0434"},{key:"country",label:"\u041a\u0440\u0430\u0457\u043d\u0430"},{key:"type",label:"\u0422\u0438\u043f"},{key:"class",label:"\u041a\u043b\u0430\u0441"},{key:"category",label:"\u041a\u0430\u0442\u0435\u0433\u043e\u0440\u0456\u044f"},{key:"purpose",label:"\u041f\u0440\u0438\u0437\u043d\u0430\u0447\u0435\u043d\u043d\u044f"},{key:"gender",label:"\u0421\u0442\u0430\u0442\u044c"},{key:"active_ingredients",label:"\u0410\u043a\u0442\u0438\u0432\u043d\u0456 \u0456\u043d\u0433\u0440\u0435\u0434\u0456\u0454\u043d\u0442\u0438"}],I=e=>{const t=f.features.filter(((t,a)=>a!==e)).map((e=>e.key)).filter((e=>e));return D.filter((e=>!t.includes(e.key)))},J=e=>{const t=f.store_prices.filter(((t,a)=>a!==e)).map((e=>e.store_id)).filter((e=>e));return p.filter((e=>!t.includes(e.id.toString())))};return(0,o.jsxs)("div",{className:"admin-product-edit animate-page",children:[(0,o.jsx)("h2",{className:"centered-heading",children:"\u0420\u0435\u0434\u0430\u0433\u0443\u0432\u0430\u0442\u0438 \u0442\u043e\u0432\u0430\u0440"}),(0,o.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),!g)return void b("\u0412\u0438\u0431\u0435\u0440\u0456\u0442\u044c \u0442\u043e\u0432\u0430\u0440 \u0434\u043b\u044f \u0440\u0435\u0434\u0430\u0433\u0443\u0432\u0430\u043d\u043d\u044f.");if(C(!0),b(null),k(null),!f.category_id||!f.brand_id||!f.name)return b("\u0417\u0430\u043f\u043e\u0432\u043d\u0456\u0442\u044c \u043e\u0431\u043e\u0432\u2019\u044f\u0437\u043a\u043e\u0432\u0456 \u043f\u043e\u043b\u044f: \u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0456\u044f, \u0431\u0440\u0435\u043d\u0434, \u043d\u0430\u0437\u0432\u0430"),void C(!1);const t=localStorage.getItem("token"),a=new FormData;a.append("category_id",f.category_id),a.append("brand_id",f.brand_id),a.append("name",f.name),a.append("volume",f.volume),a.append("code",f.code),a.append("description",f.description),a.append("description_full",f.description_full),a.append("composition",f.composition),a.append("usage",f.usage);const s=f.features.reduce(((e,t)=>(t.key&&t.value&&(e[t.key]=t.value),e)),{});a.append("features",JSON.stringify(s));const n=f.store_prices.filter((e=>e.store_id&&e.price&&!isNaN(parseFloat(e.price))));a.append("store_prices",JSON.stringify(n));const i=f.images.filter((e=>"existing"===e.type&&e.url&&!e.url.includes("placeholder.webp"))).map((e=>e.url));a.append("existing_images",JSON.stringify(i)),f.images.forEach((e=>{"new"===e.type&&e.file instanceof File&&a.append("images",e.file)}));try{await r.A.put("".concat(l.H,"/admin/product/").concat(g),a,{headers:{Authorization:"Bearer ".concat(t),"Content-Type":"multipart/form-data"}}),k("\u0422\u043e\u0432\u0430\u0440 \u0443\u0441\u043f\u0456\u0448\u043d\u043e \u043e\u043d\u043e\u0432\u043b\u0435\u043d\u043e!")}catch(d){var o,c;console.error("\u041f\u043e\u043c\u0438\u043b\u043a\u0430 \u043e\u043d\u043e\u0432\u043b\u0435\u043d\u043d\u044f \u0442\u043e\u0432\u0430\u0440\u0443:",{message:d.message,response:d.response?d.response.data:"No response data"}),b((null===(o=d.response)||void 0===o||null===(c=o.data)||void 0===c?void 0:c.error)||"\u041d\u0435 \u0432\u0434\u0430\u043b\u043e\u0441\u044f \u043e\u043d\u043e\u0432\u0438\u0442\u0438 \u0442\u043e\u0432\u0430\u0440. \u041f\u0435\u0440\u0435\u0432\u0456\u0440\u0442\u0435 \u0434\u0430\u043d\u0456 \u0430\u0431\u043e \u043f\u0456\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u043d\u044f \u0434\u043e \u0441\u0435\u0440\u0432\u0435\u0440\u0430.")}finally{C(!1)}},children:[(0,o.jsxs)("div",{className:"form-group animate-field",children:[(0,o.jsx)("label",{children:"\u0422\u043e\u0432\u0430\u0440"}),(0,o.jsxs)("select",{value:g,onChange:e=>h(e.target.value),children:[(0,o.jsx)("option",{value:"",children:"\u0412\u0438\u0431\u0435\u0440\u0456\u0442\u044c \u0442\u043e\u0432\u0430\u0440"}),e.map((e=>(0,o.jsxs)("option",{value:e.id,children:[e.name," (ID: ",e.id,")"]},e.id)))]})]}),(0,o.jsxs)("div",{className:"form-group animate-field",children:[(0,o.jsx)("label",{children:"\u041a\u0430\u0442\u0435\u0433\u043e\u0440\u0456\u044f"}),(0,o.jsxs)("select",{name:"category_id",value:f.category_id,onChange:e=>w(e),required:!0,disabled:0===a.length,children:[(0,o.jsx)("option",{value:"",children:"\u0412\u0438\u0431\u0435\u0440\u0456\u0442\u044c \u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0456\u044e"}),a.map((e=>(0,o.jsx)("option",{value:e.id,children:e.name_ua},e.id)))]}),0===a.length&&(0,o.jsx)("p",{children:"\u0417\u0430\u0432\u0430\u043d\u0442\u0430\u0436\u0435\u043d\u043d\u044f \u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0456\u0439..."})]}),(0,o.jsxs)("div",{className:"form-group animate-field",children:[(0,o.jsx)("label",{children:"\u0411\u0440\u0435\u043d\u0434"}),(0,o.jsxs)("select",{name:"brand_id",value:f.brand_id,onChange:e=>w(e),required:!0,disabled:0===d.length,children:[(0,o.jsx)("option",{value:"",children:"\u0412\u0438\u0431\u0435\u0440\u0456\u0442\u044c \u0431\u0440\u0435\u043d\u0434"}),d.map((e=>(0,o.jsx)("option",{value:e.id,children:e.name},e.id)))]}),0===d.length&&(0,o.jsx)("p",{children:"\u0417\u0430\u0432\u0430\u043d\u0442\u0430\u0436\u0435\u043d\u043d\u044f \u0431\u0440\u0435\u043d\u0434\u0456\u0432..."})]}),(0,o.jsxs)("div",{className:"form-group animate-field",children:[(0,o.jsx)("label",{children:"\u041d\u0430\u0437\u0432\u0430"}),(0,o.jsx)("input",{type:"text",name:"name",value:f.name,onChange:e=>w(e),required:!0})]}),f.images.map(((e,t)=>(0,o.jsxs)("div",{className:"form-group animate-field image-group",children:[(0,o.jsxs)("label",{children:["\u0417\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u043d\u044f ",t+1]}),(0,o.jsxs)("div",{className:"input-with-button",children:[(0,o.jsx)("input",{type:"file",accept:"image/*",onChange:e=>w(e,t,"image","image")}),(0,o.jsxs)("div",{className:"button-group",children:[t===f.images.length-1&&f.images.length<10&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("button",{type:"button",className:"add-button",onClick:S,children:"+"}),f.images.length>1&&(0,o.jsx)("button",{type:"button",className:"remove-button",onClick:()=>F(t),children:"-"})]}),t!==f.images.length-1&&(0,o.jsx)("button",{type:"button",className:"remove-button",onClick:()=>F(t),children:"-"})]})]}),v[t]&&(0,o.jsx)("div",{className:"image-preview",children:(0,o.jsx)("img",{src:v[t],alt:"Preview ".concat(t+1)})})]},t))),(0,o.jsxs)("div",{className:"form-group animate-field",children:[(0,o.jsx)("label",{children:"\u041e\u0431\u2019\u0454\u043c"}),(0,o.jsx)("input",{type:"text",name:"volume",value:f.volume,onChange:e=>w(e)})]}),(0,o.jsxs)("div",{className:"form-group animate-field",children:[(0,o.jsx)("label",{children:"\u041a\u043e\u0434"}),(0,o.jsx)("input",{type:"text",name:"code",value:f.code,onChange:e=>w(e)})]}),(0,o.jsx)("h3",{children:"\u0425\u0430\u0440\u0430\u043a\u0442\u0435\u0440\u0438\u0441\u0442\u0438\u043a\u0438"}),f.features.map(((e,t)=>(0,o.jsx)("div",{className:"form-group feature-group animate-field",children:(0,o.jsxs)("div",{className:"input-with-button",children:[(0,o.jsxs)("select",{value:e.key,onChange:e=>w(e,t,"key","feature"),children:[(0,o.jsx)("option",{value:"",children:"\u0412\u0438\u0431\u0435\u0440\u0456\u0442\u044c \u0445\u0430\u0440\u0430\u043a\u0442\u0435\u0440\u0438\u0441\u0442\u0438\u043a\u0443"}),I(t).map((e=>(0,o.jsx)("option",{value:e.key,children:e.label},e.key)))]}),(0,o.jsx)("input",{type:"text",value:e.value,onChange:e=>w(e,t,"value","feature"),placeholder:"\u0417\u043d\u0430\u0447\u0435\u043d\u043d\u044f"}),(0,o.jsxs)("div",{className:"button-group",children:[t===f.features.length-1&&f.features.length<10&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("button",{type:"button",className:"add-button",onClick:H,children:"+"}),f.features.length>1&&(0,o.jsx)("button",{type:"button",className:"remove-button",onClick:()=>O(t),children:"-"})]}),t!==f.features.length-1&&(0,o.jsx)("button",{type:"button",className:"remove-button",onClick:()=>O(t),children:"-"})]})]})},t))),(0,o.jsxs)("div",{className:"form-group animate-field",children:[(0,o.jsx)("label",{children:"\u041a\u043e\u0440\u043e\u0442\u043a\u0438\u0439 \u043e\u043f\u0438\u0441"}),(0,o.jsx)("textarea",{name:"description",value:f.description,onChange:e=>w(e)})]}),(0,o.jsxs)("div",{className:"form-group animate-field",children:[(0,o.jsx)("label",{children:"\u041f\u043e\u0432\u043d\u0438\u0439 \u043e\u043f\u0438\u0441"}),(0,o.jsx)("textarea",{name:"description_full",value:f.description_full,onChange:e=>w(e)})]}),(0,o.jsxs)("div",{className:"form-group animate-field",children:[(0,o.jsx)("label",{children:"\u0421\u043a\u043b\u0430\u0434"}),(0,o.jsx)("textarea",{name:"composition",value:f.composition,onChange:e=>w(e)})]}),(0,o.jsxs)("div",{className:"form-group animate-field",children:[(0,o.jsx)("label",{children:"\u0412\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u0430\u043d\u043d\u044f"}),(0,o.jsx)("textarea",{name:"usage",value:f.usage,onChange:e=>w(e)})]}),(0,o.jsx)("h3",{children:"\u0426\u0456\u043d\u0438 \u0432 \u043c\u0430\u0433\u0430\u0437\u0438\u043d\u0430\u0445"}),f.store_prices.map(((e,t)=>(0,o.jsx)("div",{className:"form-group store-price-group animate-field",children:(0,o.jsxs)("div",{className:"input-with-button",children:[(0,o.jsxs)("select",{value:e.store_id,onChange:e=>w(e,t,"store_id","store_price"),children:[(0,o.jsx)("option",{value:"",children:"\u0412\u0438\u0431\u0435\u0440\u0456\u0442\u044c \u043c\u0430\u0433\u0430\u0437\u0438\u043d"}),J(t).map((e=>(0,o.jsx)("option",{value:e.id,children:e.name},e.id)))]}),(0,o.jsx)("input",{type:"number",value:e.price,onChange:e=>w(e,t,"price","store_price"),placeholder:"\u0426\u0456\u043d\u0430",min:"0",step:"0.01"}),(0,o.jsx)("input",{type:"text",value:e.link,onChange:e=>w(e,t,"link","store_price"),placeholder:"\u041f\u043e\u0441\u0438\u043b\u0430\u043d\u043d\u044f"}),(0,o.jsxs)("div",{className:"button-group",children:[t===f.store_prices.length-1&&f.store_prices.length<10&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("button",{type:"button",className:"add-button",onClick:E,children:"+"}),f.store_prices.length>1&&(0,o.jsx)("button",{type:"button",className:"remove-button",onClick:()=>q(t),children:"-"})]}),t!==f.store_prices.length-1&&(0,o.jsx)("button",{type:"button",className:"remove-button",onClick:()=>q(t),children:"-"})]})]})},t))),j&&(0,o.jsx)("div",{className:"error-message centered-message",children:j}),_&&(0,o.jsx)("div",{className:"success-message centered-message",children:_}),(0,o.jsx)("button",{type:"submit",className:"save-button animate-field",disabled:N,children:N?"\u041e\u043d\u043e\u0432\u043b\u0435\u043d\u043d\u044f...":"\u041e\u043d\u043e\u0432\u0438\u0442\u0438 \u0442\u043e\u0432\u0430\u0440"})]})]})}},5222:()=>{}}]);
//# sourceMappingURL=287.7e472ae2.chunk.js.map