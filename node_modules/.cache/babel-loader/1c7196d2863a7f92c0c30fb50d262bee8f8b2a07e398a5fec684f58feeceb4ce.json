{"ast":null,"code":"import React,{useEffect,useState}from'react';import{Navigate,Outlet,useLocation}from'react-router-dom';import axios from'axios';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function ProtectedRoute(){const[isAuthenticated,setIsAuthenticated]=useState(null);const location=useLocation();useEffect(()=>{const checkToken=async()=>{// Skip validation if already on login page to avoid infinite redirects\nif(location.pathname==='/login'){console.log('On login page, skipping token validation');setIsAuthenticated(false);return;}const token=localStorage.getItem('token');console.log('Checking token:',{token:token?'present':'missing'});if(!token){console.log('No token found, redirecting to login');setIsAuthenticated(false);return;}try{console.log('Making API call to /profile');const response=await axios.get('https://price-ua-react-backend.onrender.com/profile',{headers:{Authorization:`Bearer ${token}`}});console.log('Token validation successful:',response.data);setIsAuthenticated(true);}catch(err){var _err$response,_err$response2,_err$response3,_err$response4,_err$response5,_err$response5$data,_err$response5$data$e,_err$response6,_err$response6$data,_err$response6$data$e;console.error('Token validation failed:',{status:(_err$response=err.response)===null||_err$response===void 0?void 0:_err$response.status,data:(_err$response2=err.response)===null||_err$response2===void 0?void 0:_err$response2.data,message:err.message});if(((_err$response3=err.response)===null||_err$response3===void 0?void 0:_err$response3.status)===401||((_err$response4=err.response)===null||_err$response4===void 0?void 0:_err$response4.status)===403||(_err$response5=err.response)!==null&&_err$response5!==void 0&&(_err$response5$data=_err$response5.data)!==null&&_err$response5$data!==void 0&&(_err$response5$data$e=_err$response5$data.error)!==null&&_err$response5$data$e!==void 0&&_err$response5$data$e.toLowerCase().includes('недійсний токен')||(_err$response6=err.response)!==null&&_err$response6!==void 0&&(_err$response6$data=_err$response6.data)!==null&&_err$response6$data!==void 0&&(_err$response6$data$e=_err$response6$data.error)!==null&&_err$response6$data$e!==void 0&&_err$response6$data$e.toLowerCase().includes('jwt expired')){console.log('Invalid or expired token, clearing token and redirecting to login');localStorage.removeItem('token');setIsAuthenticated(false);}else{console.error('Unexpected error during token validation:',err);setIsAuthenticated(false);// Redirect on any error to be safe\n}}};checkToken();},[location.pathname]);if(isAuthenticated===null){return/*#__PURE__*/_jsx(\"div\",{className:\"loading-overlay\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"spinner-container\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"spinner\"}),/*#__PURE__*/_jsx(\"p\",{children:\"\\u0417\\u0430\\u0432\\u0430\\u043D\\u0442\\u0430\\u0436\\u0435\\u043D\\u043D\\u044F...\"})]})});}return isAuthenticated?/*#__PURE__*/_jsx(Outlet,{}):/*#__PURE__*/_jsx(Navigate,{to:\"/login\",replace:true,state:{from:location}});}export default ProtectedRoute;","map":{"version":3,"names":["React","useEffect","useState","Navigate","Outlet","useLocation","axios","jsx","_jsx","jsxs","_jsxs","ProtectedRoute","isAuthenticated","setIsAuthenticated","location","checkToken","pathname","console","log","token","localStorage","getItem","response","get","headers","Authorization","data","err","_err$response","_err$response2","_err$response3","_err$response4","_err$response5","_err$response5$data","_err$response5$data$e","_err$response6","_err$response6$data","_err$response6$data$e","error","status","message","toLowerCase","includes","removeItem","className","children","to","replace","state","from"],"sources":["C:/Users/pushy/Documents/GitHub/price-ua-react/price-ua-react-frontend/src/components/ProtectedRoute.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport { Navigate, Outlet, useLocation } from 'react-router-dom';\r\nimport axios from 'axios';\r\n\r\nfunction ProtectedRoute() {\r\n  const [isAuthenticated, setIsAuthenticated] = useState(null);\r\n  const location = useLocation();\r\n\r\n  useEffect(() => {\r\n    const checkToken = async () => {\r\n      // Skip validation if already on login page to avoid infinite redirects\r\n      if (location.pathname === '/login') {\r\n        console.log('On login page, skipping token validation');\r\n        setIsAuthenticated(false);\r\n        return;\r\n      }\r\n\r\n      const token = localStorage.getItem('token');\r\n      console.log('Checking token:', { token: token ? 'present' : 'missing' });\r\n\r\n      if (!token) {\r\n        console.log('No token found, redirecting to login');\r\n        setIsAuthenticated(false);\r\n        return;\r\n      }\r\n\r\n      try {\r\n        console.log('Making API call to /profile');\r\n        const response = await axios.get('https://price-ua-react-backend.onrender.com/profile', {\r\n          headers: { Authorization: `Bearer ${token}` },\r\n        });\r\n        console.log('Token validation successful:', response.data);\r\n        setIsAuthenticated(true);\r\n      } catch (err) {\r\n        console.error('Token validation failed:', {\r\n          status: err.response?.status,\r\n          data: err.response?.data,\r\n          message: err.message,\r\n        });\r\n        if (\r\n          err.response?.status === 401 ||\r\n          err.response?.status === 403 ||\r\n          err.response?.data?.error?.toLowerCase().includes('недійсний токен') ||\r\n          err.response?.data?.error?.toLowerCase().includes('jwt expired')\r\n        ) {\r\n          console.log('Invalid or expired token, clearing token and redirecting to login');\r\n          localStorage.removeItem('token');\r\n          setIsAuthenticated(false);\r\n        } else {\r\n          console.error('Unexpected error during token validation:', err);\r\n          setIsAuthenticated(false); // Redirect on any error to be safe\r\n        }\r\n      }\r\n    };\r\n\r\n    checkToken();\r\n  }, [location.pathname]);\r\n\r\n  if (isAuthenticated === null) {\r\n    return (\r\n      <div className=\"loading-overlay\">\r\n        <div className=\"spinner-container\">\r\n          <div className=\"spinner\"></div>\r\n          <p>Завантаження...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return isAuthenticated ? <Outlet /> : <Navigate to=\"/login\" replace state={{ from: location }} />;\r\n}\r\n\r\nexport default ProtectedRoute;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}